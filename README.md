# Run
Компилирует файл, написанный на языке C, запускает команды `clang-format`, `valgrind` и `cppcheck` с их предустановленными опциями и выполняет скомпилированную программу до тех пор, пока вы не прекратите ее выполнение - основная идея заключается в том, чтобы ускорить ваш учебный процесс в бассейне школы 21, путем выполнения данных команд с помощью всего одной - `run`.

Теперь вам не нужно:
- Отдельно вызывать эти команды для форматирования/проверки/компиляции вашего кода;
- Прописывать вручную опции для каждой команды - они хранятся в одном файле, и вы можете их изменить;
- Хранить `.clang-format` в рабочей директории;
- Запускать программу снова и снова, чтобы протестировать её.

# Оглавление
<details>
<br>

1. [Использование](#использование)
2. [Описание](#описание)
3. [Установка](#установка) <br>
   3.1. [Cпособ 1 - Ручная установка](#способ-1-ручная-установка) <br>
   3.2. [Способ 2 - Клонирование репозитория](#cпособ-2-клонирование-репозитория)      
5. [Опции](#опции)
6. [Примеры](#примеры)
7. [Обновления](#обновления)
8. [Автор](#автор)
</details>

# Использование <a name="использование"></a>
```
run FILE (Напр. run main.c)
run [OPTION] (Напр. run -d)
run [OPTION] COMMAND (Напр. run -r cppcheck)
```

# Описание <a name="описание"></a>
`run` вызывает следующие команды:
1. [clang-format](https://clang.llvm.org/docs/ClangFormat.html) - форматирует исходный код. Вы можете указать свой `.clang-format` во время установки команды `run` - `./run_installer.sh .clang-format` - или, вызвав уже установленную команду: `run -cl .clang-format`, где `.clang-format` - это ваш файл с предустановленными правилами форматирования исходного кода.
> Обратите внимание, если вы не указали этот файл, `run` будет использовать предопределенный файл `.clang-format`, который вы можете посмотреть в этом репозитории, он находится в `src/.clang-format`.
2. [cppcheck](http://cppcheck.net/manual.html) - выполняет статический анализ написанного кода с целью обнаружение ошибок и фокусируется на выявлении неопределенного поведения и опасных конструкций;
3. [gcc](https://gcc.gnu.org/onlinedocs/) - компилирует исходный код в исполняемый файл;
4. [valgrind](https://valgrind.org/docs/manual/manual.html) - используется для анализа программ на наличие утечек памяти и обнаружения ошибок при работе с памятью.

При обнаружении каких-либо ошибок статического анализатора кода (cppcheck), компиляции (gcc) или утечек памяти (valgrind) программа прекращает свое выполнение, сохраняет файл с ошибкой во временную папку `log` и открывает его в новом окне текстового редактора.

В остальных случаях ваш скомпилированный файл будет выполняться до тех пор, пока вы не остановите его, нажав `Esc`.

Все эти команды используют предопределенные опции, которые вы можете отредактировать, вызвав `run -c` или `run --change-options` (подробности указаны [ниже](#опции)), или восстановить опции по умолчанию: `run -d` или `run --default`.

<details>
<summary>Опции по умолчанию для указанных команд:</summary>
<br>

```
clang-format: -i
gcc: -Wall -Werror -Wextra -std=c11 -g
cppcheck: --verbose --enable=all --template=gcc *.cpp *.h *.c --error-exitcode=1
valgrind: --leak-check=full --show-leak-kinds=all --track-origins=yes --verbose --error-exitcode=1
```
</details>

Чтобы посмотреть опции, которые используются сейчас, введите `run -v` или `run --view-options`.

Вы даже можете остановить выполнение некоторых команд. Например, если вы не хотите форматировать ваш исходный код, то в этом случае вам необходимо написать `run -r clang-format` или `run --remove=clang-format`. Чтобы возобновить их, напишите `run -a <command-name>` или `run --add=<command-name>`.

Чтобы вспомнить предназначение некоторых опций, выполните `run -h` или `run --help`.

# Установка <a name="установка"></a>
> Данная команда разрабатывалась под Linux, но вы также можете использовать ее на Windows, установив под нее подсистему для Linux - WSL ([видеоинструкция по установке](https://www.youtube.com/watch?v=X-DHaQLrBi8&pp=ygUZaG93IHRvIGluc3RhbGwgd3NsIHVidW50dQ%3D%3D)). В которой в дальнейшем вы сможете запускать различные дистрибутивы Linux - я использую Ubuntu =) 

## Способ 1 - Ручная установка <a name="способ-1-ручная-установка"></a>
1. Скачайте своими ручками сырой файл `run_installer` с корневой папки репозитория (нажмите на файл, и в открывшемся окне, в верхнем правом углу, нажмите на значок загрузки);
2. Откройте терминал в подсистеме Linux;
3. Создайте папку в домашнем каталоге, в которую поместите скачанный скрипт. Введите `mkdir ~/<dir_name>`, где `<dir_name>` - имя вашего каталога (пр. `mkdir ~/runner`);
4. Переместите скачанный файл из Windows в свою подсистему для Linux в созданную папку, введя следующую команду: `mv /mnt/c/Users/<windows.username>/Downloads/run_installer ~/<dest_folder>`, где `<windows.username>` - это имя пользователя, под котором вы сейчас работаете и под которым загрузили файл. Вы можете ввести `mv /mnt/c/Users/`, а затем нажать комбинацию клавиш `Ctrl + D` для отображения списка возможных дополнений, а уже после этого выбрать подходящего пользователя и ввести остальную часть команды; `~/<dest_folder>` - это папка, в которую вы хотите поместить ваш файл в подсистеме Linux. В моем случае, мне необходимо поместить скрипт в папку `runner`, т.е. `~/runner`. У меня полная команда будет выглядеть так: `mv /mnt/c/Users/Gleb/Downloads/run_installer ~/runner`;
5. Перейдите в тот каталог, куда вы переместили файл. В моем случае: `cd ~/runner`;
6. Теперь вам необходимо [установить](https://www.youtube.com/watch?v=GsG5roSGha0&pp=ygUm0YPRgdGC0LDQvdC-0LLQutCwIGdpdCDQvdCwIHdpbmRvd3MgMTA%3D) `git`, для того чтобы выгрузить данные из удаленного репозитория - этот процесс выполняется в самом установщике. Затем создать аккаунт на [GitHub](https://github.com/);
7. После этого вам необходимо запустить скрипт: `./run_installer`, в котором от вас потребуется ввести username и [токен персонального доступа](https://www.geeksforgeeks.org/how-to-generate-personal-access-token-in-github/). Персональный токен — безопасная альтернатива использованию пароля для аутентификации на Github в командной строке или через API. Созданный персональный токен используется _в момент аутентификации_ для HTTPS репозитория;
> Если возникла следующая ошибка: `bash: permission denied: ./run_installer` - значит, вам необходимо предоставить права на выполнение данного файла. Для этого введите: `chmod +x run_installer`.
8. Все, теперь вы можете пользоваться командой 'run', к примеру, открыть краткие сведения о команде: `run -h`.
> При возникновении следующей ошибки: `zsh: command not found: run` - введите: `source "${HOME}/.$( ps -cp "$$" -o command="" )rc"` - эта команда получает активную интерактивную оболочку по ее запущенному процессу и запускает файл, в котором содержится строка, благодаря которой наша оболочка находит путь до исполняемого файла команды 'run'. Всякий раз при вызове команды `run`, оболочка ищет данный исполняемый файл по указанному пути и, в случае нахождения, запускает ее.

## Способ 2 - Клонирование репозитория <a name="cпособ-2-клонирование-репозитория"></a>
1. Откройте терминал в подсистеме Linux;
2. Введите команду для клонирования данного репозитория: `git clone git@github.com:MikhailovDev/runner.git ~/<dir_name>`, где `~/<dir_name>` это директория, куда вы хотите сохранить локальную версию удаленного репозитория;
3. Перейдите в тот каталог, куда вы клонировали репозиторий;
4. Удалите ненужные файлы, введя следующую команду: `for item in $(find .); do; [[ "$item" != *"run_installer"* ]] && rm -rf "$item"; done`;
5. Выполните шаги 7-8 из **Способа 1**.

# Опции <a name="опции"></a>
> Обратите внимание, вы не можете комбинировать опции, определенные для данной команды, поскольку в этом нет смысла. Например, вы не можете написать `run -dr`, чтобы одновременно использовать опции `-d` и `-r`.

> Команда `run` открывает файлы в текстовом редакторе, указанном в переменной окружения `EDITOR`, если она не задана, по умолчанию открывается `vim`.

```
-u, --uninstall
        Удаляет команду 'run'.

-c, --change-options
        Открывает файл с опциями вышеуказанных комманд, заданными пользователем, с целью их изменения.
        Обратите внимание, вы не можете удалять, переименовывать команды или добавлять другие строки - вы можете только добавлять или удалять опции, следующие после двоеточия и разделенные пробелом.

-v, --view-options
        Показывает опции команд, установленных пользователем, в режиме только для чтения.

-d, --default
        Восстанавливает исходные опции команд, которые были установлены по умолчанию.

-cl, --clang-format=YOUR-CLANG-FORMAT-FILE
        Обновляет текущий файл '.clang-format' на указанный 'YOUR-CLANG-FORMAT-FILE'.

-r, --remove=COMMAND-NAME
        Останавливает выполнение команды. `COMMAND-NAME` больше не будет выполняться при запуске 'run', пока вы не возобновите его при помощью опции `-a`.

-a, --add=COMMAND-NAME
        Возобновляет работу остановленной команды. `COMMAND-NAME` продолжает работу с опциями, которые были указаны перед ее остановкой.

-h, --help
        Отображает краткую информацию по использованию команды 'run'.
```

# Примеры <a name="примеры"></a>
```
run main.c
run -v

run --remove=cppcheck

run -cl .clang-format
run --clang-format=.clang-format
```

# Обновления <a name="обновления"></a>
Чтобы установить новую версию, вам следует повторно запустить скрипт `run_installer.sh`. Он удалит текущую версию команды `run` на вашем компьютере и выгрузит новую из удаленного репозитория.

# Автор <a name="автор"></a>
Михайлов Глеб - участник бассейна школы 21 (22.07.24)
> Гоу пир-ту-пириться - ТГ: [@goglebgo](https://t.me/goglebgo) =)
